<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statyczna Mapa Medal√≥w - Test</title>
   <!-- <link rel="stylesheet" href="leaflet/leaflet.css">-->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header h1 {
            margin: 0;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            margin: 10px 0 0 0;
            font-size: 1.1em;
            opacity: 0.9;
        }

        #map {
            height: 70vh;
            width: 100%;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            border: 3px solid #fff;
        }

        .medal-popup {
            min-width: 250px;
            text-align: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .medal-popup h3 {
            color: #2c3e50;
            margin: 0 0 15px 0;
            font-size: 1.3em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }

        .medal-info {
            background: #ecf0f1;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .medal-counter {
            font-size: 1.2em;
            font-weight: bold;
            color: #27ae60;
        }

        .medal-button {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 20px;
            margin-top: 15px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .medal-button:hover {
            background: linear-gradient(45deg, #2980b9, #1f4e79);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .medal-button:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .stats-panel {
            background: white;
            padding: 20px;
            margin-top: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
        }

        .stat-item {
            text-align: center;
            min-width: 120px;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #3498db;
            display: block;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 0.9em;
            text-transform: uppercase;
        }

        .reset-button {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            margin-top: 20px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .reset-button:hover {
            background: #c0392b;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            #map {
                height: 60vh;
            }

            .stats-panel {
                flex-direction: column;
            }

            .stat-item {
                margin-bottom: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üèÜ Mapa Medal√≥w</h1>
        <p>Kliknij w pinezki na mapie, aby zebraƒá medale. Stan jest zapisywany lokalnie w przeglƒÖdarce.</p>
    </div>

    <div id="map"></div>

    <div class="stats-panel">
        <div class="stat-item">
            <span class="stat-number" id="collected-count">0</span>
            <span class="stat-label">Zebrane medale</span>
        </div>
        <div class="stat-item">
            <span class="stat-number" id="total-available">0</span>
            <span class="stat-label">Dostƒôpne medale</span>
        </div>
        <div class="stat-item">
            <span class="stat-number" id="total-medals">0</span>
            <span class="stat-label">Wszystkie medale</span>
        </div>
    </div>

    <button class="reset-button" onclick="resetAllMedals()">üîÑ Resetuj wszystkie medale</button>

    <script src="medale.js"></script>
    <script>
        // Inicjalizacja mapy z niestandardowym obrazem
        const map = L.map('map', {
            crs: L.CRS.Simple,
            minZoom: -2,
            maxZoom: 3,
            center: [0, 0],
            zoom: 0
        });

        // Wymiary obrazu mapy (mo≈ºesz dostosowaƒá do swojego obrazu)
        const mapWidth = 2560;
        const mapHeight = 1809;
        const bounds = [[0, 0], [mapHeight, mapWidth]];

        // Dodanie obrazu mapy jako overlay
        const imageOverlay = L.imageOverlay('mapa-przyklad.jpg', bounds).addTo(map);

        // Ustawienie widoku mapy
        map.fitBounds(bounds);
        map.setView([mapHeight/2, mapWidth/2], 0);

        // Obiekt do przechowywania referencji do pinezek
        const medalMarkers = {};

        // Funkcja pobierania aktualnego licznika medalu
        function pobierzLicznikMedalu(medalId) {
            const saved = localStorage.getItem(`medal-${medalId}`);
            if (saved !== null) {
                return parseInt(saved);
            }
            // Je≈õli nie ma zapisanej warto≈õci, zwr√≥ƒá poczƒÖtkowƒÖ ilo≈õƒá
            const medal = medale.find(m => m.id === medalId);
            return medal ? medal.poczatkowa_ilosc : 0;
        }

        // Funkcja zapisywania licznika medalu
        function zapiszLicznnikMedalu(medalId, nowaWartosc) {
            localStorage.setItem(`medal-${medalId}`, nowaWartosc.toString());
            aktualizujStatystyki();
        }

        // Funkcja zabrania medalu
        function zabierzMedal(medalId) {
            const aktualnyLicznik = pobierzLicznikMedalu(medalId);

            if (aktualnyLicznik > 0) {
                const nowyLicznik = aktualnyLicznik - 1;
                zapiszLicznnikMedalu(medalId, nowyLicznik);

                // Aktualizacja interfejsu
                document.getElementById(`counter-${medalId}`).textContent = nowyLicznik;

                // Zablokowanie przycisku je≈õli medale siƒô sko≈Ñczy≈Çy
                const przycisk = document.getElementById(`button-${medalId}`);
                if (nowyLicznik === 0) {
                    przycisk.disabled = true;
                    przycisk.textContent = '‚ùå Brak medali';

                    // Zmiana koloru pinezki na szary
                    if (medalMarkers[medalId]) {
                        medalMarkers[medalId].setStyle({
                            color: '#95a5a6',
                            fillColor: '#bdc3c7'
                        });
                    }
                }

                // Efekt wizualny
                przycisk.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    przycisk.style.transform = 'scale(1)';
                }, 150);

                console.log(`Medal ${medalId} zabrany. Pozosta≈Ço: ${nowyLicznik}`);
            }
        }

        // Funkcja resetowania wszystkich medali
        function resetAllMedals() {
            if (confirm('Czy na pewno chcesz zresetowaƒá wszystkie medale do stanu poczƒÖtkowego?')) {
                medale.forEach(medal => {
                    localStorage.removeItem(`medal-${medal.id}`);
                });

                // Prze≈Çadowanie strony dla prostoty
                location.reload();
            }
        }

        // Funkcja aktualizacji statystyk
        function aktualizujStatystyki() {
            let zebraneMetale = 0;
            let dostepneMetale = 0;
            let wszystkieMetale = 0;

            medale.forEach(medal => {
                const aktualna = pobierzLicznikMedalu(medal.id);
                const poczatkowa = medal.poczatkowa_ilosc;

                dostepneMetale += aktualna;
                wszystkieMetale += poczatkowa;
                zebraneMetale += (poczatkowa - aktualna);
            });

            document.getElementById('collected-count').textContent = zebraneMetale;
            document.getElementById('total-available').textContent = dostepneMetale;
            document.getElementById('total-medals').textContent = wszystkieMetale;
        }

        // Inicjalizacja pinezek na mapie
        function inicjalizujPinezki() {
            medale.forEach(medal => {
                const aktualnyLicznik = pobierzLicznikMedalu(medal.id);
                const czyDostepny = aktualnyLicznik > 0;

                // Okre≈õlenie koloru pinezki
                const kolor = czyDostepny ? medal.kolor : '#95a5a6';
                const kolorWypelnienia = czyDostepny ? medal.kolor : '#bdc3c7';

                // Tworzenie pinezki jako ko≈Ço
                const pinezka = L.circle([medal.y, medal.x], {
                    color: kolor,
                    fillColor: kolorWypelnienia,
                    fillOpacity: 0.7,
                    radius: 30,
                    weight: 3
                }).addTo(map);

                // Zapisanie referencji do pinezki
                medalMarkers[medal.id] = pinezka;

                // Tworzenie zawarto≈õci popup-a
                const tekstPrzycisku = czyDostepny ? 'üèÜ Zabierz medal' : '‚ùå Brak medali';
                const stanPrzycisku = czyDostepny ? '' : 'disabled';

                const popupContent = `
                    <div class="medal-popup">
                        <h3>üèÖ ${medal.nazwa}</h3>
                        <div class="medal-info">
                            <p><strong>Opis:</strong> ${medal.opis || 'Cenny medal do zebrania'}</p>
                            <div class="medal-counter">
                                Dostƒôpne: <span id="counter-${medal.id}">${aktualnyLicznik}</span>
                            </div>
                        </div>
                        <button 
                            class="medal-button" 
                            id="button-${medal.id}"
                            onclick="zabierzMedal(${medal.id})"
                            ${stanPrzycisku}
                        >
                            ${tekstPrzycisku}
                        </button>
                    </div>
                `;

                // PowiƒÖzanie popup-a z pinezkƒÖ
                pinezka.bindPopup(popupContent, {
                    maxWidth: 300,
                    className: 'custom-popup'
                });

                // Tooltip z nazwƒÖ medalu
                pinezka.bindTooltip(medal.nazwa, {
                    permanent: false,
                    direction: 'top',
                    offset: [0, -10]
                });
            });

            // Aktualizacja statystyk na poczƒÖtku
            aktualizujStatystyki();
        }

        // Inicjalizacja aplikacji po za≈Çadowaniu
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Inicjalizacja mapy medal√≥w...');
            console.log(`üìç Za≈Çadowano ${medale.length} medali`);
            inicjalizujPinezki();
        });

        // Dodanie obs≈Çugi zdarze≈Ñ dla lepszej interakcji
        map.on('popupopen', function(e) {
            console.log('Popup otwarty dla medalu');
        });

        map.on('zoomend', function(e) {
            console.log(`Zoom zmieniony na: ${map.getZoom()}`);
        });
    </script>
</body>
</html>
